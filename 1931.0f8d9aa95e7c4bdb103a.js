(self.webpackChunkpebula=self.webpackChunkpebula||[]).push([[1931],{91931:(e,t,i)=>{"use strict";i.d(t,{z6:()=>c});var s=i(71436),n=i(62866),o=i(59670),r=i(61511),l=i(20531),a=i(64914),h=i(39030),d=i(31572);let c=(()=>{class e{}return e.NGRID_PLUGIN=(0,a.Ic)({id:o.dm},o.ml),e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=d.oAB({type:e}),e.\u0275inj=d.cJS({imports:[[r.ez,l.HT,a.dC,h.sx]]}),e})();d.B6R(n.xX,[n.NF,s.Q],[])},59670:(e,t,i)=>{"use strict";i.d(t,{dm:()=>a,ml:()=>c});var s=i(31572),n=i(19861),o=i(64914),r=i(62866);class l{constructor(e,t){this.vcRef=e,this.extApi=t,this.viewMap=new Map,this.pendingOps=new Map,this.deferOps=!1,this.runMeasure=()=>this.extApi.grid.viewport.reMeasureCurrentRenderedContent(),t.onInit(()=>{this.detailRowDef=t.grid.registry.getSingle("detailRow"),t.cdkTable.beforeRenderRows.subscribe(()=>this.deferOps=!0),t.cdkTable.onRenderRows.subscribe(()=>this.flushPendingOps())}),t.grid.registry.changes.subscribe(e=>{for(const t of e)switch(t.type){case"detailRow":this.detailRowDef="remove"===t.op?void 0:t.value}})}render(e,t){return this.viewMap.has(e)?(this.pendingOps.delete(e),this.updateDetailRow(e),!0):this.deferOps?!(!e.context.$implicit||!this.detailRowDef||(this.pendingOps.set(e,{type:"render",fromRender:t}),0)):this._render(e,t)}clearDetailRow(e,t){this.viewMap.get(e)&&(this.deferOps?this.pendingOps.set(e,{type:"clear",fromRender:t}):this._clearDetailRow(e,t))}updateDetailRow(e){const t=this.viewMap.get(e);t&&(Object.assign(t.viewRef.context,this.createDetailRowContext(e,!0)),t.viewRef.detectChanges())}getDetailRowHeight(e){let t=0;const i=this.viewMap.get(e);if(i)for(const s of i.viewRef.rootNodes)t+=s.getBoundingClientRect().height;return t}detectChanges(e){const t=this.viewMap.get(e);t&&t.viewRef.detectChanges()}createDetailRowContext(e,t){return{$implicit:e.context.$implicit,rowContext:e.context,animation:{fromRender:t,end:()=>this.checkHasAnimation(t)?this.runMeasure():void 0}}}flushPendingOps(){if(this.deferOps){this.deferOps=!1;const e=[],t=[];for(const i of this.pendingOps.entries())("clear"===i[1].type?t:e).push(i);this.pendingOps.clear();for(const[i,s]of e){if(this.viewMap.has(i))return;if(t.length){const[e]=t.pop();this.viewMap.set(i,this.viewMap.get(e)),this.viewMap.delete(e),this.insertElementsToRow(i),this.updateDetailRow(i),this.checkHasAnimation(s.fromRender)||this.runMeasure()}else this._render(i,s.fromRender)}for(const[i,s]of t)this._clearDetailRow(i,s.fromRender)}}_render(e,t){if(e.context.$implicit&&this.detailRowDef){const i=this.createDetailRowContext(e,t);return this.viewMap.set(e,{viewRef:this.vcRef.createEmbeddedView(this.detailRowDef.tRef,i)}),this.insertElementsToRow(e,!0),this.checkHasAnimation(t)||this.runMeasure(),!0}return!1}_clearDetailRow(e,t){const i=this.viewMap.get(e);if(i){const{viewRef:s}=i;s.context.animation.fromRender!==t&&(s.context.animation.fromRender=t,s.detectChanges()),s.destroy(),this.checkHasAnimation(t)||this.runMeasure(),this.viewMap.delete(e)}}insertElementsToRow(e,t){const{viewRef:i}=this.viewMap.get(e),s=e.element.nextSibling;for(const n of i.rootNodes)e.element.parentElement.insertBefore(n,s);t&&i.detectChanges()}checkHasAnimation(e){return"always"===this.detailRowDef.hasAnimation||"interaction"===this.detailRowDef.hasAnimation&&!e}}const a="detailRow",h=()=>!0,d=()=>!1;let c=(()=>{class e{constructor(e,t,i,n){this.pluginCtrl=t,this.ngZone=i,this.injector=n,this.whenContextChange="context",this.toggleChange=new s.vpe,this.toggledRowContextChange=new s.vpe,this._isSimpleRow=h,this._isDetailRow=d,this._detailRowRows=new Set,this._removePlugin=t.setPlugin(a,this),this.grid=t.extApi.grid,this.detailRowCtrl=new l(e,t.extApi),t.onInit().subscribe(()=>{t.ensurePlugin("targetEvents"),this.grid.registry.changes.subscribe(e=>{for(const t of e)switch(t.type){case"detailRowParent":"remove"===t.op&&(this.pluginCtrl.extApi.cdkTable.removeRowDef(t.value),this._detailRowDef=void 0),this.setupDetailRowParent()}}),this._detailRow?this.updateTable():this.setupDetailRowParent()})}get detailRow(){return this._detailRow}set detailRow(e){if(this._detailRow!==e){const t=this.grid;"function"==typeof e?(this._isSimpleRow=(t,i)=>!e(t,i),this._isDetailRow=e):(e=(0,n.Ig)(e),this._isDetailRow=e?h:d,this._isSimpleRow=e?d:h),this._detailRow=e,t.isInit&&this.updateTable()}}set singleDetailRow(e){if(e=(0,n.Ig)(e),this._forceSingle!==e&&(this._forceSingle=e,e&&this._openedRow&&this._openedRow.expended))for(const t of this._detailRowRows)t.context.$implicit!==this._openedRow.row&&t.toggle(!1)}addDetailRow(e){this._detailRowRows.add(e)}removeDetailRow(e){this._detailRowRows.delete(e)}toggleDetailRow(e,t){for(const i of this._detailRowRows)if(i.context.$implicit===e)return i.toggle(t),i.expended}markForCheck(){this._cdPending||(this._cdPending=!0,this.ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>{this.ngZone.run(()=>{var e;this._cdPending=!1,null===(e=this._defaultParentRef)||void 0===e||e.changeDetectorRef.markForCheck()})})))}ngOnDestroy(){this._defaultParentRef&&this._defaultParentRef.destroy(),this._removePlugin(this.grid)}detailRowToggled(e){const t=this._openedRow&&this._openedRow.row===e.row;e.expended?(this._forceSingle&&this._openedRow&&this._openedRow.expended&&!t&&this._openedRow.toggle(),this._openedRow=e):t&&(this._openedRow=void 0),this.toggleChange.emit(e)}setupDetailRowParent(){if(this._detailRowDef&&(this.pluginCtrl.extApi.cdkTable.removeRowDef(this._detailRowDef),this._detailRowDef=void 0),this.detailRow){let e=this.pluginCtrl.extApi.registry.getSingle("detailRowParent");if(e)this._detailRowDef=e=e.clone(),Object.defineProperty(e,"when",{enumerable:!0,get:()=>this._isDetailRow});else if(!this._defaultParentRef)return this._defaultParentRef=this.injector.get(s._Vd).resolveComponentFactory(r.xX).create(this.injector),void this._defaultParentRef.changeDetectorRef.detectChanges()}this.resetTableRowDefs()}resetTableRowDefs(){this._detailRowDef&&(!1===this._detailRow?this.pluginCtrl.extApi.cdkTable.removeRowDef(this._detailRowDef):this.pluginCtrl.extApi.cdkTable.addRowDef(this._detailRowDef))}updateTable(){this.grid._tableRowDef.when=this._isSimpleRow,this.setupDetailRowParent(),this.pluginCtrl.extApi.cdkTable.updateRowDefCache(),this.pluginCtrl.extApi.cdkTable.multiTemplateDataRows=!!this._detailRow}}return e.\u0275fac=function(t){return new(t||e)(s.Y36(s.s_b),s.Y36(o.q5),s.Y36(s.R0b),s.Y36(s.zs3))},e.\u0275dir=s.lG2({type:e,selectors:[["pbl-ngrid","detailRow",""]],inputs:{detailRow:"detailRow",singleDetailRow:"singleDetailRow",excludeToggleFrom:"excludeToggleFrom",whenContextChange:"whenContextChange"},outputs:{toggleChange:"toggleChange",toggledRowContextChange:"toggledRowContextChange"},exportAs:["pblNgridDetailRow"]}),e})()},62866:(e,t,i)=>{"use strict";i.d(t,{A_:()=>r,NF:()=>l,xX:()=>a});var s=i(64914),n=i(31572);function o(e,t){1&e&&n._UZ(0,"pbl-ngrid-row",1)}let r=(()=>{class e extends s.iT{constructor(e,t){super(e,t),this.kind="detailRow"}}return e.\u0275fac=function(t){return new(t||e)(n.Y36(n.Rgc),n.Y36(s.B6))},e.\u0275dir=n.lG2({type:e,selectors:[["","pblNgridDetailRowDef",""]],inputs:{hasAnimation:["pblNgridDetailRowDefHasAnimation","hasAnimation"]},features:[n.qOj]}),e})(),l=(()=>{class e extends s.rB{ngOnInit(){this.registry.setSingle("detailRowParent",this)}ngOnDestroy(){this.registry.getSingle("detailRowParent")===this&&this.registry.setSingle("detailRowParent",void 0)}}return e.\u0275fac=function(){let t;return function(i){return(t||(t=n.n5z(e)))(i||e)}}(),e.\u0275dir=n.lG2({type:e,selectors:[["","pblNgridDetailRowParentRef",""]],inputs:{columns:["pblNgridDetailRowParentRef","columns"],when:["pblNgridDetailRowParentRefWhen","when"]},features:[n.qOj]}),e})(),a=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=n.Xpm({type:e,selectors:[["pbl-ngrid-default-detail-row-parent"]],decls:1,vars:0,consts:[["detailRow","",4,"pblNgridDetailRowParentRef"],["detailRow",""]],template:function(e,t){1&e&&n.YNc(0,o,1,0,"pbl-ngrid-row",0)},encapsulation:2}),e})()},71436:(e,t,i)=>{"use strict";i.d(t,{Q:()=>w});var s=i(31572),n=i(75842),o=i(20531),r=i(7997),l=i(64914),a=i(59670);const h=["viewRef"],d=["detailRow",""],c=[[["",8,"pbl-ngrid-row-prefix"]],[["",8,"pbl-ngrid-row-suffix"]]],p=[".pbl-ngrid-row-prefix",".pbl-ngrid-row-suffix"];let w=(()=>{class e extends l.wk{constructor(){super(...arguments),this.opened=!1}get expended(){return this.opened}get height(){return super.height+this.controller.getDetailRowHeight(this)}get row(){return this.context.$implicit}ngOnInit(){super.ngOnInit(),this.plugin.addDetailRow(this);const e=this._extApi.pluginCtrl.getPlugin("targetEvents");e.cellClick.pipe((0,r.dW)(this)).subscribe(e=>{if("data"===e.type&&e.row===this.context.$implicit){const{excludeToggleFrom:t}=this.plugin;t&&t.some(t=>e.column.id===t)||this.toggle()}}),e.rowClick.pipe((0,r.dW)(this)).subscribe(e=>{e.root||"data"!==e.type||e.row!==this.context.$implicit||this.toggle()})}ngOnDestroy(){r.dW.kill(this),this.plugin.removeDetailRow(this),this.controller.clearDetailRow(this,!0),super.ngOnDestroy()}updateRow(){if(super.updateRow()){switch(this.plugin.whenContextChange){case"context":const e=!!this.context.getExternal("detailRow");e&&this.opened?this.controller.updateDetailRow(this):this.toggle(e,!0);break;case"render":this.opened&&this.controller.updateDetailRow(this);break;case"close":this.toggle(!1,!0)}return this.plugin.markForCheck(),this.controller.detectChanges(this),this.plugin.toggledRowContextChange.next(this),!0}return!1}toggle(e,t=!1){if(this.opened!==e){let e=!1;this.opened?(this.controller.clearDetailRow(this,t),this.element.classList.remove("pbl-row-detail-opened")):this.controller.render(this,t)&&(e=!0,this.element.classList.add("pbl-row-detail-opened")),this.opened!==e&&(this.opened=e,this.context.setExternal("detailRow",e,!0),this.plugin.detailRowToggled(this))}}handleKeydown(e){if(e.target===this.element){const t=e.keyCode;(t===n.K5||t===n.L_)&&(e.preventDefault(),this.toggle())}}onCtor(){super.onCtor(),this.plugin=this._extApi.pluginCtrl.getPlugin(a.dm),this.controller=this.plugin.detailRowCtrl}}return e.\u0275fac=function(){let t;return function(i){return(t||(t=s.n5z(e)))(i||e)}}(),e.\u0275cmp=s.Xpm({type:e,selectors:[["pbl-ngrid-row","detailRow",""]],viewQuery:function(e,t){if(1&e&&s.Gf(h,7,s.s_b),2&e){let e;s.iGM(e=s.CRH())&&(t._viewRef=e.first)}},hostAttrs:["role","row",1,"pbl-ngrid-row","pbl-row-detail-parent"],hostVars:1,hostBindings:function(e,t){1&e&&s.NdJ("keydown",function(e){return t.handleKeydown(e)}),2&e&&s.uIk("tabindex",t.grid.rowFocus)},exportAs:["pblNgridDetailRow"],features:[s._Bn([{provide:o._J,useExisting:e}]),s.qOj],attrs:d,ngContentSelectors:p,decls:4,vars:0,consts:[["viewRef",""]],template:function(e,t){1&e&&(s.F$t(c),s.Hsn(0),s.GkF(1,null,0),s.Hsn(3,1))},styles:[".pbl-row-detail-parent{position:relative;cursor:pointer}"],encapsulation:2,changeDetection:0}),e})()}}]);