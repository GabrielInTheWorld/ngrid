!function(){function t(e,n,i){return(t="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=g(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(e,n,i||e)}function e(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=o(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,u=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return s=t.done,t},e:function(t){u=!0,a=t},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw a}}}}function n(t){return function(t){if(Array.isArray(t))return s(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||o(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t){var e="function"==typeof Map?new Map:void 0;return(i=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,i)}function i(){return r(t,arguments,g(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),f(i,t)})(t)}function r(t,e,n){return(r=p()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&f(r,n.prototype),r}).apply(null,arguments)}function a(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],i=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(u){r=!0,a=u}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}return n}(t,e)||o(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){if(t){if("string"==typeof t)return s(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(t,e):void 0}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function l(t,e,n){return e&&c(t.prototype,e),n&&c(t,n),t}function h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&f(t,e)}function f(t,e){return(f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function d(t){var e=p();return function(){var n,i=g(t);if(e){var r=g(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return v(this,n)}}function v(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function p(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function g(t){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{"8r4k":function(t,e,n){"use strict";n.d(e,"a",function(){return f});var i=n("f6nW"),r=n("XEBs"),a=n("fXoL"),o=["infiniteRow",""],s=[[["",8,"pbl-ngrid-row-prefix"]],"*",[["",8,"pbl-ngrid-row-suffix"]]],c=[".pbl-ngrid-row-prefix","*",".pbl-ngrid-row-suffix"],f=function(){var t=function(t){h(n,t);var e=d(n);function n(){return u(this,n),e.apply(this,arguments)}return l(n,[{key:"canCreateCell",value:function(){return!1}}]),n}(r.o);return t.\u0275fac=function(e){return v(e||t)},t.\u0275cmp=a.Ob({type:t,selectors:[["pbl-ngrid-row","infiniteRow",""]],hostAttrs:["role","row",1,"pbl-ngrid-row"],exportAs:["pblNgridInfiniteRow"],features:[a.Gb([{provide:i.o,useExisting:r.o}]),a.Eb],attrs:o,ngContentSelectors:c,decls:3,vars:0,template:function(t,e){1&t&&(a.vc(s),a.uc(0),a.uc(1,1),a.uc(2,2))},encapsulation:2,changeDetection:0}),t}(),v=a.cc(f)},LpJu:function(r,o,s){"use strict";s.d(o,"b",function(){return F}),s.d(o,"a",function(){return at});var c=s("DcT9"),f=s("2Vo4"),v=s("LRne"),p=s("nYR2"),y=s("pLZG"),k=s("IzEk"),b=s("vkgz"),m=s("lJxs"),w={},S=function(){function t(e,n){u(this,t),this.context=e,this.end=-1,this.start=0,this._maxSize=0,this.options=Object.assign({},n||{})}return l(t,[{key:"remove",value:function(t,e){return[[Math.max(t,this.start),Math.min(t+e-1,this.end)]]}},{key:"setCacheSize",value:function(t){this._maxSize=Math.max(0,t);var e=this.alignBoundary(this.lastAdd||1);return e<0?[[this.start+e,this.start-1]]:e>0?[[this.end+1,this.end+e]]:[]}},{key:"update",value:function(t,e,n){if(this.empty)return this.add(t,e-t+1);if(!this.isSibling(t,e,n)){var i=this.clear();return this.add(t,e-t+1),i}return-1===n?this.add(t,this.start-t):1===n?this.add(this.end+1,e-this.end):void 0}},{key:"clear",value:function(){if(this.lastAdd=void 0,this.empty)return[[0,0]];var t=this.start,e=this.end;return this.start=0,this.end=-1,[[t,e]]}},{key:"createBlock",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=this.matchBlock(t,e)||[],r=a(i,3),o=r[0],s=r[1],u=r[2];if(o){var c,l,h=this.context.options.blockSize;switch(o){case-1:c=Math.max(0,u-(h-1)),l=u;break;case 1:c=s,l=s+h-1}if(!(n&&c>=n)){var f=1===o?c:l,d=f%h;return 0!==d&&(l=(c=f-d)+h-1),n&&l>=n&&(c=(l=n-1)-l%h),[o,c,l]}}}},{key:"matchBlock",value:function(t,e){return this.empty?[1,t,e]:t>=this.start&&e<=this.end?void 0:t<this.start&&e>=this.start-1?[-1,t,this.start-1]:e>this.end&&t<=this.end+1?[1,this.end+1,e]:[e>this.end?1:-1,t,e]}},{key:"oversize",value:function(){return this._maxSize?Math.max(this.size-this._maxSize,0):0}},{key:"isSibling",value:function(t,e,n){return 1===n?this.end+1===t:-1===n&&this.start-1===e}},{key:"add",value:function(t,e){if(t<0||e<=0)return[];var n,i=t+e-1;return this.empty?(this.start=t,this.end=i,n=this.alignBoundary(1)):t<this.start?(this.start=t,n=this.alignBoundary(-(this.lastAdd=-1))):i>this.end&&(this.end=i,n=this.alignBoundary(-(this.lastAdd=1))),n<0?[[this.start+n,this.start-1]]:n>0?[[this.end+1,this.end+n]]:[]}},{key:"alignBoundary",value:function(t){var e=this.oversize();if(e){if(1!==t)return this.start+=e,-e;this.end-=e}return e}},{key:"maxSize",get:function(){return this._maxSize}},{key:"size",get:function(){return this.end-this.start+1}},{key:"empty",get:function(){return 0===this.size}}]),t}(),R=function(){function t(e,n){u(this,t),this.start=e,this.end=n}return l(t,[{key:"containsRow",value:function(t){return t>=this.start&&t<=this.end}},{key:"equals",value:function(t){return this.start===t.start&&this.end===t.end}},{key:"size",get:function(){return this.end-this.start+1}},{key:"empty",get:function(){return 0===this.size}}],[{key:"calcEnd",value:function(t,e){return t+e-1}}]),t}(),x=function(t){h(i,t);var e=d(i);function i(){var t;return u(this,i),(t=e.apply(this,arguments)).dirty=!1,t._size=0,t}return l(i,[{key:"remove",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[],a=R.calcEnd(t,e),o=this.searchByRow(t,i);if(-1!==o){var s=this[o],u=s.end,c=u-a;if(s.end=t-1,0===c)r.push([t,a]);else if(c<0)r.push.apply(r,[[t,u]].concat(n(this.remove(u+1,c,o+1))));else{var l=new R(a+1,u);this.splice(o,0,l),r.push([t,a])}r.length>0&&this.markDirty()}return r}},{key:"removeItems",value:function(t,e){for(var n,i=[];t>0&&(n=-1===e?this.shift():this.pop());)n.size>t?(-1===e?(n.start+=t,i.push([n.start-t,n.start-1])):(n.end-=t,i.push([n.end+1,n.end+t])),t=0):(t-=n.size,i.push([n.start,n.end]),n=void 0);return n&&(-1===e?this.unshift(n):this.push(n)),i.length>0&&this.markDirty(),i}},{key:"clear",value:function(){for(var t=[];this.length>0;){var e=this.shift();t.push([e.start,e.end])}return t.length>0&&this.markDirty(),t}},{key:"findClosestMissing",value:function(t,e){var n=this[this.searchByRow(t)];return n?1===e?n.end+1:n.start-1:t}},{key:"containsRange",value:function(t,e){var n=this[this.searchByRow(t)];return n&&e<=n.end}},{key:"searchByRow",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.length-1;e<=n;){var i=Math.floor((e+n)/2),r=this[i];if(r.containsRow(t))return i;r.end<t?e=i+1:n=i-1}return-1}},{key:"searchRowProximity",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.length-1,i=-1;e<=n;){var r=Math.floor((e+n)/2),a=this[r];if(a.containsRow(t))return r;a.end<t?e=r+1:(i=r,n=r-1)}return i}},{key:"markDirty",value:function(){this.dirty=!0}},{key:"checkAndMerge",value:function(){for(var t=1;t<this.length;t++)this[t-1].end+1===this[t].start&&(this[t-1].end=this[t].end,this.splice(t,1),t-=1)}},{key:"onDirty",value:function(){this.dirty=!1,this._size=this.reduce(function(t,e){return t+e.size},0)}},{key:"size",get:function(){return this.dirty&&this.onDirty(),this._size}}]),i}(i(Array)),O=function(t){return t[t.none=0]="none",t[t.full=1]="full",t[t.contained=2]="contained",t[t.contains=3]="contains",t[t.partial=4]="partial",t}({});function z(t,e,n){return t.equals(e)?O.full:(void 0===n&&(r=e,a=(i=t).start<r.start?i:r,o=a===i?r:i,n=a.end<o.start?null:new R(o.start,a.end<o.end?a.end:o.end)),n?t.equals(n)?O.contained:e.equals(n)?O.contains:O.partial:O.none);var i,r,a,o}var T=function(){function t(e,n){u(this,t),this.context=e,this._maxSize=0,this.fragments=new x,this.lastStartRow=0,this.lastDir=1,this.options=Object.assign({},n||{})}return l(t,[{key:"remove",value:function(t,e){return this.fragments.remove(t,e)}},{key:"setCacheSize",value:function(t){return this._maxSize=Math.max(0,t),this.alignBoundary()}},{key:"update",value:function(t,e,n){return this.coldLocation=1===n?-1:1,this.add(t,e)}},{key:"clear",value:function(){return this.coldLocation=void 0,this.empty?[[0,0]]:this.fragments.clear()}},{key:"createBlock",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=this.matchBlock(t,e)||[],r=a(i,3),o=r[0],s=r[1],u=r[2];if(o){var c,l,h=this.context.options.blockSize,f=this.options.strictPaging;switch(o){case-1:c=Math.max(0,u-(h-1)),l=u,!f&&c<s&&(c=Math.min(this.fragments.findClosestMissing(c,1),s));break;case 1:c=s,l=s+h-1,!f&&l>u&&(l=Math.max(this.fragments.findClosestMissing(l,-1),u))}if(!(n&&c>=n)){if(f){var d=1===o?c:l,v=d%h;0!==v&&(l=(c=d-v)+h-1)}return n&&l>=n&&(l=n-1,f&&(c=l-l%h)),[o,c,l]}}}},{key:"matchBlock",value:function(t,e){if(this.empty)return[1,t,e];var n=this.fragments.searchRowProximity(t),i=this.fragments.searchRowProximity(e);if(-1===n)return[1,t,e];var r=this.fragments[n];if(-1===i)return[1,r.containsRow(t)?r.end+1:t,e];var a=z(r,new R(t,e)),o=this.lastStartRow>t?-1:this.lastStartRow===t?this.lastDir:1;switch(this.lastStartRow=t,this.lastDir=o,a){case O.none:return[o,t,e];case O.partial:if(n===i)return t<r.start?[o,t,r.start-1]:[o,r.end+1,e];var s=this.fragments[i];return[o,t<r.start?t:r.end+1,e>=s.start?s.start-1:e];case O.contained:var u=this.fragments[i];return[o,t,e>=u.start?u.start-1:e];case O.contains:case O.full:return}}},{key:"add",value:function(t,e){if(t<0||e<=0)return[];var n=new R(t,e),i=this.fragments.searchRowProximity(t),r=this.fragments[i];switch(r?z(r,n):null){case null:this.fragments.push(n);break;case O.none:this.fragments.splice(i,0,n);break;case O.partial:case O.contained:var a=this.fragments.searchRowProximity(e);-1===a&&(a=this.fragments.length-1);var o=this.fragments[a];r.start=Math.min(n.start,r.start),n.end>=o.start?(r.end=n.end,this.fragments.splice(i+1,a-i)):(r.end=Math.max(n.end,r.end),this.fragments.splice(i+1,a-1-i));break;case O.contains:case O.full:return[]}return this.fragments.markDirty(),this.fragments.checkAndMerge(),this.alignBoundary()}},{key:"oversize",value:function(){return this._maxSize?Math.max(this.size-this._maxSize,0):0}},{key:"alignBoundary",value:function(){var t=this.oversize();return t>0?this.fragments.removeItems(t,this.coldLocation||1):[]}},{key:"maxSize",get:function(){return this._maxSize}},{key:"size",get:function(){return this.fragments.size}},{key:"empty",get:function(){return 0===this.size}}]),t}(),D=function(){function t(e,n){u(this,t),this.context=e,this.virtualRow=n,this.ds=e.getDataSource()}return l(t,[{key:"remove",value:function(t,e){return[[0,Math.min(t+e-1,this.ds.length)]]}},{key:"setCacheSize",value:function(t){return[]}},{key:"update",value:function(t,e,n){return[]}},{key:"clear",value:function(){return[[0,this.ds.length-1]]}},{key:"createBlock",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=this.matchBlock(t,e)||[],r=a(i,3),o=r[0],s=r[1],u=r[2];if(o){var c,l,h=this.context.options.blockSize;switch(o){case-1:c=Math.max(0,u-(h-1)),l=u;break;case 1:c=s,l=s+h-1}return n&&c>=n?void 0:(n&&l>=n&&(l=n-1),[o,c,l])}}},{key:"matchBlock",value:function(t,e){if(t===e)return[1,t,e];for(var n=this.ds.source,i=t;i<=e&&n[i]!==this.virtualRow;i++)t=i;return t===e?void 0:[1,t,e]}},{key:"maxSize",get:function(){return this.ds.length}},{key:"size",get:function(){return this.ds.length}},{key:"empty",get:function(){return 0===this.size}}]),t}(),C=function(){function t(e,n){u(this,t),this.context=e,this.cacheAdapter=function(t,e){switch(e.type){case"noOpCache":return new D(t,w);case"sequenceBlocks":return new S(t,e.options);case"fragmentedBlocks":return new T(t,e.options)}}(e,function(t){return t||(t={type:"noOpCache"}),t}(n)),this.setCacheSize(300)}return l(t,[{key:"setCacheSize",value:function(t){this.cacheAdapter.setCacheSize(t)}},{key:"matchNewBlock",value:function(){var t=this.context.getDataSource(),e=this.context.totalLength,n=t.renderStart+t.renderLength,i=t.renderStart,r=e?Math.min(n,e):n;return this.cacheAdapter.createBlock(i,r,e)}},{key:"createInitialBlock",value:function(){var t=this.context.getDataSource(),e=this.context.totalLength,n=t.renderLength,i=e?Math.min(n,e):n;return this.cacheAdapter.createBlock(0,i,e)}},{key:"update",value:function(t,e,n){return this.cacheAdapter.update(t,e,n)}},{key:"clear",value:function(){return this.cacheAdapter.clear()}},{key:"maxSize",get:function(){return this.cacheAdapter.maxSize}},{key:"size",get:function(){return this.cacheAdapter.size}},{key:"empty",get:function(){return this.cacheAdapter.empty}}]),t}();function V(t){var e=t.getDataSource();return!(t.totalLength&&e.renderStart>t.totalLength||!t.cache.matchNewBlock())}function _(t,e,n){var i=t.length;if(i<e.totalLength&&e.totalLength>e.toRow&&t[i-1]!==w){for(var r=Math.min(i+n-1,e.totalLength),a=i;a<r;a++)t[a]=w;return!0}return!1}var L=s("XEBs"),A=function(t){h(i,t);var n=d(i);function i(t,e){var r;return u(this,i),(r=n.call(this,t.getAdapter(),e)).context=t,r}return l(i,[{key:"setCacheSize",value:function(t){this.context.cache.setCacheSize(t)}},{key:"purgeCache",value:function(){var t,n=this.source,i=e(this.context.cache.clear());try{for(i.s();!(t=i.n()).done;)for(var r=a(t.value,2),o=r[0],s=r[1],u=o;u<=s;u++)n[u]=w}catch(c){i.e(c)}finally{i.f()}this.refresh()}},{key:"isVirtualRow",value:function(t){return t===w}},{key:"isVirtualContext",value:function(t){return t.$implicit===w}},{key:"updateVirtualSize",value:function(t){var e=this;this.adapter.inFlight?this.onRenderDataChanging.pipe(Object(k.a)(1)).subscribe(function(n){i.updateVirtualSize(t,n.data),e._onRenderDataChanging.next(n)}):i.updateVirtualSize(t,this.source)}},{key:"maxCacheSize",get:function(){return this.context.cache.maxSize}},{key:"cacheSize",get:function(){return this.context.cache.size}}],[{key:"updateVirtualSize",value:function(t,e){if(e&&e.length<t)for(var n=e.length;n<t;n++)e[n]=w}}]),i}(L.c),j=s("Kj3r"),I=function(e){h(i,e);var n=d(i);function i(t,e,r){var a;return u(this,i),(a=n.call(this,function(e){return t.onTrigger(e)},e)).context=t,a.virtualRowsLoading=r.pipe(Object(j.a)(24)),a}return l(i,[{key:"dispose",value:function(){this.context.dispose(),t(g(i.prototype),"dispose",this).call(this)}},{key:"emitOnSourceChanging",value:function(e){e.isInitial&&t(g(i.prototype),"emitOnSourceChanging",this).call(this,e)}}]),i}(L.d),B=s("7+OI"),E=s("Cfvw"),M=s("HDdC"),P=s("XNiG"),N=function(t){h(n,t);var e=d(n);function n(t,i){var r;return u(this,n),(r=e.call(this,function(t){return r.onSubscribe(t)})).event=t,r.target=i,r.onKilled=new P.a,r.canLive=!1,r}return l(n,[{key:"keepAlive",value:function(){this.canLive=!0}},{key:"onSubscribe",value:function(t){var e=this;return this.subscriber=t,this.baseSubscription||(this.baseSubscription=this.target.subscribe({next:function(t){return e.subscriber.next(t)},error:function(t){e.error=t,e.subscriber.error(t)},complete:function(){e.completed=!0,e.subscriber.complete()}})),function(){return e.tearDown()}}},{key:"tearDown",value:function(){!this.canLive||this.completed||this.error?(this.baseSubscription.unsubscribe(),this.onKilled.next(),this.onKilled.complete()):this.canLive=!1}}]),n}(M.a),G=function(){function t(e){u(this,t),this.handler=e,this.slots=2,this.runningEvents=new Map}return l(t,[{key:"execute",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.checkOverlap(t);if(i)return!!n&&(i.keepAlive(),i);var r=this.handler(t);if(!1===r)return!1;var a=Array.isArray(r)?Object(v.a)(r):Object(B.a)(r)?r:Object(E.a)(r),o=new N(t,a);return o.onKilled.subscribe(function(){return e.runningEvents.delete(t)}),this.runningEvents.set(t,o),o}},{key:"checkOverlap",value:function(t){var n,i=e(this.runningEvents.entries());try{for(i.s();!(n=i.n()).done;){var r=a(n.value,2),o=r[0],s=r[1];if(t.fromRow>=o.fromRow&&t.toRow<=o.toRow)return s}}catch(u){i.e(u)}finally{i.f()}}}]),t}(),q=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;u(this,t),this.event=e}return l(t,[{key:"isDone",value:function(){return this.done}},{key:"rangeEquals",value:function(t){return t.fromRow===this.event.fromRow&&t.toRow===this.event.toRow}},{key:"skipNextRender",value:function(){return!!this.notFull&&(this.notFull=!1,!0)}},{key:"pipe",value:function(){var t=this;return function(e){return e.pipe(Object(b.a)(function(e){t.done=!0,t.notFull=e.length<t.event.offset}))}}}]),t}(),X=function(){function t(e){var n,i;u(this,t),this.factoryOptions=e,this.onVirtualLoading=new f.a(!1),this.virtualLoadingSessions=0,this.timeoutCancelTokens=new Set,this.ignoreScrolling=!1,this.lastEventState=new q,this.options=(n=e.infiniteOptions,(i=n||{}).blockSize=Number(i.blockSize),(Number.isNaN(i.blockSize)||i.blockSize<=0)&&(i.blockSize=50),i.initialVirtualSize=Number(i.initialVirtualSize),Number.isNaN(i.initialVirtualSize)&&(i.initialVirtualSize=0),i),this.options.initialVirtualSize>0&&(this.totalLength=this.options.initialVirtualSize),this.queue=new G(this.factoryOptions.onTrigger)}return l(t,[{key:"onTrigger",value:function(t){var e=this;if(t.isInitial)return this.invokeInitialOnTrigger(t);if(this.pendingTrigger$){var n=this.pendingTrigger$;if(this.pendingTrigger$=void 0,t.data.changed&&t.data.curr===n)return this.currentSessionToken=void 0,n.pipe(Object(p.a)(function(){e.deferSyncRows(16,function(){return e.tickVirtualLoading(-1)})}))}if(this.currentSessionToken&&t.data.changed&&t.data.curr===this.currentSessionToken){if(this.ds.hostGrid.viewport.isScrolling)return this.handleScrolling(t),Object(v.a)(this.ds.source);var i=this.invokeRuntimeOnTrigger(t),r=i.result,a=i.event;if(r&&a){var o=this.ds.source;return _(o,a,this.options.blockSize)?(this.pendingTrigger$=r,this.tickVirtualLoading(1),Object(v.a)(o).pipe(Object(p.a)(function(){e.deferSyncRows(),e.currentSessionToken=void 0,e.ds.refresh(r)}))):r.pipe(Object(p.a)(function(){e.deferSyncRows(16),e.currentSessionToken=void 0}))}return this.currentSessionToken=void 0,!1}return!!(t.data.changed||this.customTriggers&&I.isCustomBehaviorEvent(t,this.customTriggers))&&(this.cache.clear(),t.isInitial=!0,this.invokeInitialOnTrigger(t))}},{key:"getAdapter",value:function(){return this.adapter||(this.customTriggers=this.factoryOptions.customTriggers||!1,this.adapter=new I(this,{filter:!0,sort:!0,pagination:!0},this.onVirtualLoading)),this.adapter}},{key:"getDataSource",value:function(){var t=this;return this.ds||(this.ds=new A(this,this.factoryOptions.dsOptions),this.cache=new C(this,this.factoryOptions.cacheOptions),this.ds.onRenderedDataChanged.subscribe(function(){return t.onRenderedDataChanged()}),this.factoryOptions.onCreated&&this.factoryOptions.onCreated(this.ds)),this.ds}},{key:"dispose",value:function(){this.onVirtualLoading.complete();var t,n=e(this.timeoutCancelTokens.values());try{for(n.s();!(t=n.n()).done;){var i=t.value;clearTimeout(i)}}catch(r){n.e(r)}finally{n.f()}}},{key:"onRenderedDataChanged",value:function(){var t=this;if(!this.lastEventState.skipNextRender())if(this.currentSessionToken)this.ds.hostGrid.viewport.isScrolling?this.ignoreScrolling||(this.ignoreScrolling=!0,this.ds.hostGrid.viewport.scrolling.pipe(Object(y.a)(function(t){return 0===t}),Object(k.a)(1)).subscribe(function(e){t.ignoreScrolling=!1,V(t)&&(t.currentSessionToken=void 0,t.onRenderedDataChanged())})):this.ds.refresh(this.currentSessionToken={});else if(V(this)){var e=this.currentSessionToken={};this.safeAsyncOp(function(){t.currentSessionToken===e&&t.ds.refresh(e)},0)}}},{key:"wrapEventState",value:function(t){return(this.lastEventState=new q(t)).pipe()}},{key:"deferSyncRows",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;this.safeAsyncOp(function(){n&&n(),t.ds.hostGrid.rowsApi.syncRows("data",!0),i&&i()},e)}},{key:"safeAsyncOp",value:function(t,e){var n=this,i=setTimeout(function(){n.timeoutCancelTokens.delete(i),t()},e);this.timeoutCancelTokens.add(i)}},{key:"tickVirtualLoading",value:function(t){this.virtualLoadingSessions=this.virtualLoadingSessions+t;var e=this.onVirtualLoading.value;switch(this.virtualLoadingSessions){case 0:e&&this.onVirtualLoading.next(!1);break;case 1:!e&&this.onVirtualLoading.next(!0);break;default:this.virtualLoadingSessions<0&&(this.virtualLoadingSessions=0)}}},{key:"handleScrolling",value:function(t){var e=this;this.tickVirtualLoading(1);var n=this.cache.matchNewBlock(),i=!!n&&this.tryGetInfiniteEvent(t,n);!1!==i&&_(this.ds.source,i,this.options.blockSize),this.ds.hostGrid.viewport.scrolling.pipe(Object(y.a)(function(t){return 0===t}),Object(k.a)(1)).subscribe(function(n){var i=e.invokeRuntimeOnTrigger(t).result;i?(e.pendingTrigger$&&e.tickVirtualLoading(-1),e.ds.refresh(e.pendingTrigger$=i)):e.pendingTrigger$?e.tickVirtualLoading(-1):e.ds.refresh(e.pendingTrigger$=Object(v.a)(e.ds.source))})}},{key:"invokeInitialOnTrigger",value:function(t){var e=this,n=this.tryGetInfiniteEvent(t,this.cache.createInitialBlock()),i=this.queue.execute(n);return i&&i.pipe(this.wrapEventState(n),Object(b.a)(function(n){e.cache.clear(),n.length>1&&e.cache.update(0,n.length-1,1),A.updateVirtualSize(e.options.initialVirtualSize,n),t.isInitial||e.ds.hostGrid.viewport.scrollToOffset(0)}))}},{key:"invokeRuntimeOnTrigger",value:function(t){var n=this,i=this.cache.matchNewBlock(),r=!!i&&this.tryGetInfiniteEvent(t,i);if(!1!==r){if(this.lastEventState.isDone()&&this.lastEventState.rangeEquals(r))return{event:!1};r.eventSource="infiniteScroll";var o=this.queue.execute(r,!0);if(!1!==o)return{event:r,result:o.pipe(this.wrapEventState(r),Object(m.a)(function(t){return function(t,n,i){if(t.cache.empty)return i;var r,o=t.getDataSource().source,s=e(t.cache.update(n.fromRow,n.toRow,n.direction));try{for(s.s();!(r=s.n()).done;)for(var u=a(r.value,2),c=u[0],l=u[1],h=c;h<=l;h++)o[h]=w}catch(p){s.e(p)}finally{s.f()}for(var f=n.fromRow,d=0,v=i.length;d<v;d++)o[d+f]=i[d];return o}(n,r,t)}))}}return{event:r}}},{key:"tryGetInfiniteEvent",value:function(t,e){var n=this,i=this.totalLength||0;return t.updateTotalLength=function(t){n.totalLength=t},t.totalLength=i,function(t,e,n){var i=a(n,3),r=i[0],o=i[1],s=i[2];return e.isInitial||1===r&&s===t-1&&(e.isLastBlock=!0),e.direction=r,e.fromRow=o,e.offset=s-o+1,e.toRow=s,e}(i,t,e)}}]),t}(),$=function(e){h(i,e);var n=d(i);function i(){return u(this,i),n.apply(this,arguments)}return l(i,[{key:"withInfiniteScrollOptions",value:function(t){return this.infiniteScrollOptions=t,this}},{key:"withCacheOptions",value:function(t,e){return this.cacheOptions={type:t,options:e},this}},{key:"create",value:function(){return this.context=new X({onTrigger:this._adapter.onTrigger,customTriggers:this._adapter.customTriggers,onCreated:this._onCreated,dsOptions:this._dsOptions,infiniteOptions:this.infiniteScrollOptions,cacheOptions:this.cacheOptions}),t(g(i.prototype),"onCreated",this).call(this,null),t(g(i.prototype),"create",this).call(this)}},{key:"createAdapter",value:function(){return this.context.getAdapter()}},{key:"createDataSource",value:function(t){return this.context.getDataSource()}}]),i}(c.i);function F(){return new $}var K=s("PIXP"),J=s("8r4k"),W=s("ofXK"),U=s("f6nW"),Z=s("4dOD"),H=s("fXoL");function Q(t,e){1&t&&(H.ac(0,"pbl-ngrid-row",1),H.Sc(1," ...Loading\n"),H.Zb())}var Y,tt,et=((Y=function(){function t(){u(this,t)}return l(t,[{key:"createCell",value:function(t){}},{key:"destroyCell",value:function(t){}}]),t}()).\u0275fac=function(t){return new(t||Y)},Y.\u0275cmp=H.Ob({type:Y,selectors:[["pbl-ngrid-default-infinite-virtual-row"]],decls:1,vars:0,consts:[["in","","class","pbl-ngrid-infinite-virtual-row","infiniteRow","",4,"pblNgridInfiniteVirtualRowDef"],["in","","infiniteRow","",1,"pbl-ngrid-infinite-virtual-row"]],template:function(t,e){1&t&&H.Qc(0,Q,2,0,"pbl-ngrid-row",0)},directives:[K.a,J.a],styles:['.pbl-ngrid-infinite-virtual-row .pbl-ngrid-cell{position:relative}.pbl-ngrid-infinite-virtual-row .pbl-ngrid-cell:before{position:absolute;top:12px;left:12px;right:12px;bottom:12px;content:" ";-webkit-animation-duration:2s;animation-duration:2s;-webkit-animation-fill-mode:forwards;animation-fill-mode:forwards;-webkit-animation-iteration-count:infinite;animation-iteration-count:infinite;-webkit-animation-name:placeload;animation-name:placeload;-webkit-animation-timing-function:ease;animation-timing-function:ease;background:#f6f7f8;background:#eee;background:linear-gradient(90deg,#eee 8%,#ddd 18%,#eee 33%);background-size:200px 100%;border-radius:4px}@-webkit-keyframes placeload{0%{background-position:-200px 0}to{background-position:200px 0}}@keyframes placeload{0%{background-position:-200px 0}to{background-position:200px 0}}'],encapsulation:2}),Y),nt=function(t,e){return e===w},it=function(t,e){return!nt(0,e)},rt=function(){function t(n,i,r){var a=this;u(this,t),this.grid=n,this.pluginCtrl=i,this.injector=r,this._enabled=!1,this._removePlugin=i.setPlugin("infiniteScroll",this),n.registry.changes.subscribe(function(t){var n,i=e(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;switch(r.type){case"infiniteVirtualRow":"remove"===r.op&&(a.pluginCtrl.extApi.cdkTable.removeRowDef(r.value),a._infiniteVirtualRowDef=void 0),a.setupInfiniteVirtualRow()}}}catch(o){i.e(o)}finally{i.f()}}),i.events.pipe(c.b).subscribe(function(){a._infiniteVirtualRowRef&&a._infiniteVirtualRowRef.destroy(),a._removePlugin(a.grid)}),i.events.subscribe(function(t){if("onDataSource"===t.kind){var e=a._enabled;a._enabled=t.curr instanceof A,a._enabled!==e&&i.onInit().subscribe(function(){return a.updateTable()})}})}return l(t,[{key:"setupInfiniteVirtualRow",value:function(){var t=this.grid;if(this._infiniteVirtualRowDef&&(this.pluginCtrl.extApi.cdkTable.removeRowDef(this._infiniteVirtualRowDef),this._infiniteVirtualRowDef=void 0),this._enabled){var e=t.registry.getSingle("infiniteVirtualRow");if(e)this._infiniteVirtualRowDef=e=e.clone(),Object.defineProperty(e,"when",{enumerable:!0,get:function(){return nt}});else if(!this._infiniteVirtualRowRef)return this._infiniteVirtualRowRef=this.injector.get(H.j).resolveComponentFactory(et).create(this.injector),void this._infiniteVirtualRowRef.changeDetectorRef.detectChanges()}this.resetTableRowDefs()}},{key:"resetTableRowDefs",value:function(){this._infiniteVirtualRowDef&&(!1===this._enabled?this.pluginCtrl.extApi.cdkTable.removeRowDef(this._infiniteVirtualRowDef):this.pluginCtrl.extApi.cdkTable.addRowDef(this._infiniteVirtualRowDef))}},{key:"updateTable",value:function(){this.grid._tableRowDef.when=this._enabled?it:void 0,this.setupInfiniteVirtualRow(),this.pluginCtrl.extApi.cdkTable.updateRowDefCache(),this.pluginCtrl.extApi.cdkTable.multiTemplateDataRows=!!this._enabled}}],[{key:"create",value:function(e,n){return new t(e,L.m.find(e),n)}}]),t}(),at=((tt=function t(){u(this,t),L.m.onCreatedSafe(t,function(e,n){n&&n.hasAncestor(t)&&n.createPlugin("infiniteScroll")})}).NGRID_PLUGIN=Object(L.u)({id:"infiniteScroll",factory:"create"},rt),tt.\u0275fac=function(t){return new(t||tt)},tt.\u0275mod=H.Sb({type:tt}),tt.\u0275inj=H.Rb({imports:[[W.c,U.r,L.j,Z.a]]}),tt)},PIXP:function(t,e,n){"use strict";n.d(e,"a",function(){return a});var i=n("XEBs"),r=n("fXoL"),a=function(){var t=function(t){h(n,t);var e=d(n);function n(){return u(this,n),e.apply(this,arguments)}return l(n,[{key:"ngOnInit",value:function(){this.registry.setSingle("infiniteVirtualRow",this)}},{key:"ngOnDestroy",value:function(){this.registry.setSingle("infiniteVirtualRow",void 0)}}]),n}(i.p);return t.\u0275fac=function(e){return o(e||t)},t.\u0275dir=r.Pb({type:t,selectors:[["","pblNgridInfiniteVirtualRowDef",""]],inputs:{columns:["pblNgridInfiniteVirtualRowDefColumns","columns"],when:["pblNgridInfiniteVirtualRowDefWhen","when"]},features:[r.Eb]}),t}(),o=r.cc(a)}}])}();